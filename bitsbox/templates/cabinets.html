{% extends "_layout/base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cabinet.css') }}">
{% endblock %}

{% block content %}

{% macro render_layout(path, layout) %}
{% if layout.type == 'container' %}
  <div class="bb-container {{ layout.class }}" style="{{ layout.style }}">
    {% for item in layout.children %}
      {{ render_layout(path + [loop.index0], item) }}
    {% endfor %}
  </div>
{% elif layout.type == 'item' %}
  {% with drawer = drawers_by_path[path | join('.')] %}
  <div class="bb-container-drawer grey lighten-2 {{ layout.class }}"
       style="{{ layout.style }}">
    {% if drawer %}
    <a href="{{ url_for('ui.drawer', drawer_id=drawer.id) }}"
        class="waves-effect" style="width: 100%; height: 100%">
      <div class="label">{{ drawer.label }}</div>
      <div class="count">
        {{ drawer.contents_count }},
        {{ drawer.collections_count }}
      </div>
    </a>
    {% endif %}
  </div>
  {% endwith %}
{% endif %}
{% endmacro %}

{% for cabinet in cabinets %}
<div>
  <h4>{{ cabinet.name }}</h4>
{% with layout = cabinet.layout | fromjson %}
  <div class="bb-container-toplevel">
    <div class="z-depth-2 grey lighten-1">
      {{ render_layout([cabinet.id], layout) }}
    </div>
  </div>
{% endwith %}
</div>
{% endfor %}

{% endblock %}
